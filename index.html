<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>è‰¯ã„ã“ã¨æ‚ªã„ã“ã¨è€ƒå¯Ÿç”¨</title>

<style>
body {
  font-family: sans-serif;
  background: #fffde7;
  margin: 20px;
}

h1, h2, h3 {
  color: #333;
}

button {
  padding: 10px;
  margin: 5px 0;
  background: #ffcc00;
  border: none;
  border-radius: 6px;
  font-size: 16px;
}

button:hover {
  opacity: 0.85;
}

input, textarea, select {
  width: 100%;
  padding: 8px;
  margin-bottom: 10px;
}

#chatBox {
  border: 1px solid #ccc;
  background: #fff;
  height: 300px;
  overflow-y: auto;
  padding: 10px;
}

.message {
  border-bottom: 1px solid #eee;
  padding: 6px 0;
}

.toc a {
  color: #007bff;
  cursor: pointer;
  font-size: 18px;
  margin-right: 10px;
}

.stamp-img {
  width: 70px;
  cursor: pointer;
  margin-right: 10px;
}

.adminOnly, .ownerOnly {
  display: none;
}

#closedScreen {
  display: none;
  text-align: center;
  margin-top: 50px;
}
</style>
</head>

<body>

<h1>è‰¯ã„ã“ã¨æ‚ªã„ã“ã¨è€ƒå¯Ÿç”¨</h1>
<p>ä½œï¼šã‚‰ã‚‚</p>

<h2>ãƒ¼ç›®æ¬¡ãƒ¼</h2>
<div class="toc">
  <a onclick="go('vote')">æŠ•ç¥¨</a>
  <a onclick="go('message')">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</a>
  <a onclick="go('admin')">ç®¡ç†è€…æ¨©é™</a>
</div>

<!-- é–‰é–ç”»é¢ -->
<div id="closedScreen">
  <h2 style="color:red;">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã¯é–‰ã–ã•ã‚Œã¦ã„ã¾ã™ã€‚</h2>
  <p>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‚’é–‹ã‘ã‚‹ã‚³ãƒ¼ãƒ‰</p>
  <input id="openCode">
  <button onclick="openSite()">é–‹ã‘ã‚‹</button>
</div>

<!-- æŠ•ç¥¨ -->
<h2 id="vote">æŠ•ç¥¨</h2>
<select id="voteSelect">
  <option>ã‚¿ã‚«ã‚­ãƒ³ã‚°</option>
  <option>ã‚¿ãƒ¼ãƒœãƒ¼</option>
  <option>ã‚¿ãƒ¼ãƒœãƒ¼ã®å¦»</option>
  <option>ã‚¤ãƒã‚¯ãƒ‹</option>
</select>
<button onclick="sendVote()">æŠ•ç¥¨ã™ã‚‹</button>
<ul id="voteList"></ul>

<!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
<h2 id="message">ã¿ã‚“ãªã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h2>

<input id="nameInput" placeholder="åå‰">
<textarea id="msgInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"></textarea>

<button onclick="sendMessage()">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹</button>
<button onclick="shareSite()">ã¿ã‚“ãªã‚’å‘¼ã¶ğŸ””</button>

<h3>ã‚¹ã‚¿ãƒ³ãƒ—</h3>
<img src="stamp1.png" class="stamp-img" onclick="sendStamp('stamp1.png')">
<img src="stamp2.png" class="stamp-img" onclick="sendStamp('stamp2.png')">
<img src="stamp3.png" class="stamp-img" onclick="sendStamp('stamp3.png')">

<div id="chatBox"></div>

<h3>è¦‹ã¦ã„ã‚‹äºº</h3>
<p>äººæ•°ï¼š<span id="viewerCount">0</span></p>
<p>IDï¼š<span id="viewerIDs">ãªã—</span></p>

<!-- ç®¡ç†è€… -->
<h2 id="admin">ç®¡ç†è€…æ¨©é™</h2>
<input id="adminCode">
<button onclick="checkAdmin()">é€ä¿¡</button>

<div class="adminOnly">
  <h3>BAN</h3>
  <input id="banId">
  <button onclick="ban()">BAN</button>

  <input id="unbanId">
  <button onclick="unban()">è§£é™¤</button>

  <h4>BANä¸­ID</h4>
  <p id="banList">ãªã—</p>
</div>

<div class="ownerOnly">
  <h3>ã‚ªãƒ¼ãƒŠãƒ¼å°‚ç”¨</h3>
  <button onclick="closeSite()">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã‚‹</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  /* ğŸ”´ ã“ã“ã«è‡ªåˆ†ã®Firebaseè¨­å®š */
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* å›ºå®šID */
let myId = localStorage.getItem("uid");
if (!myId) {
  myId = Math.random().toString(36).slice(2);
  localStorage.setItem("uid", myId);
}

/* é–‰é– */
db.ref("system/closed").on("value", s=>{
  document.getElementById("closedScreen").style.display =
    s.val() ? "block" : "none";
});

/* æŠ•ç¥¨ */
function sendVote(){
  const v = voteSelect.value;
  db.ref("votes").push(v);
}
db.ref("votes").on("value", s=>{
  const d=s.val()||{}, c={};
  for(let k in d){c[d[k]]=(c[d[k]]||0)+1}
  voteList.innerHTML="";
  for(let k in c){
    voteList.innerHTML+=`<li>${k}ï¼š${c[k]}ç¥¨</li>`;
  }
});

/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
function sendMessage(){
  db.ref("messages").push({
    name:nameInput.value,
    uid:myId,
    msg:msgInput.value,
    time:new Date().toLocaleString()
  });
  msgInput.value="";
}

function sendStamp(img){
  db.ref("messages").push({
    name:nameInput.value,
    uid:myId,
    stamp:img,
    time:new Date().toLocaleString()
  });
}

db.ref("messages").on("child_added", s=>{
  const m=s.val();
  chatBox.innerHTML =
    `<div class="message">
      <b>${m.name}</b> (${m.uid})<br>
      ${m.msg||`<img src="${m.stamp}" width="70">`}<br>
      <small>${m.time}</small>
    </div>` + chatBox.innerHTML;
});

/* å…±æœ‰ï¼ˆURLã‚³ãƒ”ãƒ¼ãªã—ï¼‰ */
function shareSite(){
  if(navigator.share){
    navigator.share({
      title: "æ¥ã¦ï¼",
      text: "ä¸€ç·’ã«è¦‹ã‚ˆã†ï¼",
      url: location.href
    });
  }else{
    alert("ã“ã®ç«¯æœ«ã¯å…±æœ‰ã«å¯¾å¿œã—ã¦ãªã„");
  }
}

/* è¦‹ã¦ã„ã‚‹äºº */
const presRef = db.ref("presence/"+myId);
db.ref(".info/connected").on("value", s=>{
  if(s.val()){
    presRef.set(true);
    presRef.onDisconnect().remove();
  }
});

let bans=[];
db.ref("bans").on("value",s=>{
  bans=Object.keys(s.val()||{});
});

db.ref("presence").on("value", s=>{
  const ids=Object.keys(s.val()||{}).filter(i=>!bans.includes(i));
  viewerCount.textContent=ids.length;
  viewerIDs.textContent=ids.join(", ")||"ãªã—";
});

/* ç®¡ç†è€… */
function checkAdmin(){
  const c=adminCode.value;
  if(c==="1x4s") document.querySelectorAll(".adminOnly").forEach(e=>e.style.display="block");
  if(c==="5y3y") document.querySelectorAll(".ownerOnly").forEach(e=>e.style.display="block");
}

function ban(){ db.ref("bans/"+banId.value).set(true); }
function unban(){ db.ref("bans/"+unbanId.value).remove(); }

db.ref("bans").on("value",s=>{
  const l=Object.keys(s.val()||{});
  banList.textContent=l.length?l.join(", "):"ãªã—";
});

/* ã‚ªãƒ¼ãƒŠãƒ¼ */
function closeSite(){
  if(confirm("é–‰ã˜ã‚‹ï¼Ÿ")) db.ref("system/closed").set(true);
}
function openSite(){
  if(openCode.value==="5y3y") db.ref("system/closed").set(false);
}

/* ç›®æ¬¡ */
function go(id){
  document.getElementById(id).scrollIntoView({behavior:"smooth"});
}
</script>

</body>
</html>
