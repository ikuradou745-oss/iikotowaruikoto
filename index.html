<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>è‰¯ã„ã“ã¨æ‚ªã„ã“ã¨è€ƒå¯Ÿç”¨</title>

<style>
  body { 
    font-family: sans-serif; 
    background: #ffffcc; 
    padding: 20px; 
  }

  .voteResult {
    font-weight: bold; 
    margin-left: 10px; 
    color: #cc9900;
  }

  #chatBox { 
    border: 1px solid #cc9900; 
    background: #fff8b3; 
    padding: 10px; 
    height: 300px; 
    overflow-y: auto; 
  }

  input, textarea { 
    width: 100%; 
    margin-bottom: 10px; 
    padding: 8px; 
    font-size: 1em; 
  }

  button { 
    background-color: #cc9900; 
    color: white; 
    padding: 10px; 
    border: none; 
    border-radius: 4px; 
    cursor: pointer; 
    margin-bottom: 10px;
  }

  .row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .row button {
    flex: 1;
  }

  p.message {
    border-bottom: 1px solid #cc9900;
    padding-bottom: 5px;
    margin-bottom: 5px;
  }

  #adminBox {
    margin-top: 40px;
    padding: 15px;
    border: 2px dashed #aa7700;
    background: #fff3a0;
  }

  #toc a {
    color: blue;
    font-weight: bold;
    margin-right: 15px;
    text-decoration: none;
  }

  #toc a:hover {
    text-decoration: underline;
  }

  #stampSelector {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #fff8b3;
    border: 2px solid #cc9900;
    border-radius: 8px;
    padding: 15px;
    z-index: 1000;
  }

  #stampSelector img {
    width: 60px;
    height: 60px;
    cursor: pointer;
    margin: 5px;
  }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>

<h1>è‰¯ã„ã“ã¨æ‚ªã„ã“ã¨è€ƒå¯Ÿç”¨</h1>
<p>ä½œï¼šã‚‰ã‚‚</p>

<h2>ãƒ¼ç›®æ¬¡ãƒ¼</h2>
<div id="toc">
  <a href="#voteSection">æŠ•ç¥¨</a>
  <a href="#messageSection">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</a>
  <a href="#adminSection">ç®¡ç†è€…æ¨©é™</a>
</div>

<h2 id="voteSection">æŠ•ç¥¨</h2>

<label><input type="radio" name="vote" value="ã‚¿ã‚«ã‚­ãƒ³ã‚°"> ã‚¿ã‚«ã‚­ãƒ³ã‚°</label>
<span class="voteResult" id="takakingCount">0ç¥¨</span><br>

<label><input type="radio" name="vote" value="ã‚¿ãƒ¼ãƒœãƒ¼"> ã‚¿ãƒ¼ãƒœãƒ¼</label>
<span class="voteResult" id="taboCount">0ç¥¨</span><br>

<label><input type="radio" name="vote" value="ã‚¿ãƒ¼ãƒœãƒ¼ã®å¦»"> ã‚¿ãƒ¼ãƒœãƒ¼ã®å¦»</label>
<span class="voteResult" id="taboWifeCount">0ç¥¨</span><br>

<button onclick="vote()">æŠ•ç¥¨ã™ã‚‹</button>

<hr>

<h2 id="messageSection">ãŠè©±ã—ã‚¾ãƒ¼ãƒ³</h2>

<input id="nameInput" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ">
<textarea id="messageInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"></textarea>

<div class="row">
  <button onclick="sendMessage()">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹</button>
  <button onclick="toggleUnknownTime()" id="timeBtn">æ™‚é–“ï¼šé€šå¸¸</button>
  <button onclick="shareBoard()">ã¿ã‚“ãªã‚’å‘¼ã¶ğŸ””</button>
</div>

<button onclick="openStampSelector()">ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é¸æŠ</button>

<div id="stampSelector">
  <img src="stamp1.png" onclick="sendStamp('stamp1.png')">
  <img src="stamp2.png" onclick="sendStamp('stamp2.png')">
  <img src="stamp3.png" onclick="sendStamp('stamp3.png')">
  <br>
  <button onclick="closeStampSelector()">é–‰ã˜ã‚‹</button>
</div>

<h3>ã¿ã‚“ãªã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
<div id="chatBox"></div>

<hr>

<script>
const firebaseConfig = {
  databaseURL: "https://iikotowaruikoto-d5aa7-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let unknownTime = false;
let userID = localStorage.getItem("userID") || Math.random().toString(36).slice(2);
localStorage.setItem("userID", userID);

/* ===== å…±æœ‰æ©Ÿèƒ½ ===== */
function shareBoard() {
  const text =
    "æ²ç¤ºæ¿ã§å¾…ã£ã¦ã‚‹ã‚ˆï¼\n" +
    "https://ikuradou745-oss.github.io/iikotowaruikoto/";

  if (navigator.share) {
    navigator.share({
      text: text
    });
  } else {
    alert("ã“ã®ç«¯æœ«ã¯å…±æœ‰ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“");
  }
}

/* ===== æ™‚é–“ ===== */
function toggleUnknownTime() {
  unknownTime = !unknownTime;
  timeBtn.textContent = unknownTime ? "æ™‚é–“ï¼šä¸æ˜" : "æ™‚é–“ï¼šé€šå¸¸";
}

/* ===== ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ===== */
function sendMessage() {
  const name = nameInput.value.trim();
  const msg = messageInput.value.trim();
  if (!name || !msg) return alert("å…¥åŠ›ã—ã¦ã­");

  db.ref("messages").push({
    name,
    msg,
    userID,
    time: unknownTime ? "ä¸æ˜" : new Date().toLocaleString(),
    type: "text"
  });

  messageInput.value = "";
}

function sendStamp(src) {
  const name = nameInput.value.trim();
  if (!name) return alert("åå‰å…¥ã‚Œã¦");

  db.ref("messages").push({
    name,
    stamp: src,
    userID,
    time: unknownTime ? "ä¸æ˜" : new Date().toLocaleString(),
    type: "stamp"
  });

  closeStampSelector();
}

function openStampSelector(){ stampSelector.style.display="block"; }
function closeStampSelector(){ stampSelector.style.display="none"; }

db.ref("messages").on("child_added", s=>{
  const m=s.val();
  const p=document.createElement("p");
  p.className="message";
  p.innerHTML =
    `<b>${m.name}</b><br>` +
    (m.type==="stamp" ? `<img src="${m.stamp}" width="80">` : m.msg) +
    `<br><small>${m.time}</small>`;
  chatBox.prepend(p);
});
</script>

</body>
</html>
