<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>è‰¯ã„ã“ã¨æ‚ªã„ã“ã¨è€ƒå¯Ÿç”¨</title>

<style>
body {
  font-family: sans-serif;
  background: #ffffcc;
  padding: 20px;
}
.voteResult { font-weight: bold; color: #cc9900; margin-left: 10px; }
#chatBox {
  border: 1px solid #cc9900;
  background: #fff8b3;
  padding: 10px;
  height: 300px;
  overflow-y: auto;
}
input, textarea {
  width: 100%;
  margin-bottom: 10px;
  padding: 8px;
}
button {
  background: #cc9900;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 4px;
  cursor: pointer;
}
.row { display: flex; gap: 10px; }
.row button { flex: 1; }
.message { border-bottom: 1px solid #cc9900; margin-bottom: 5px; }
#adminBox {
  margin-top: 40px;
  padding: 15px;
  border: 2px dashed #aa7700;
  background: #fff3a0;
}
#toc a { color: blue; font-weight: bold; margin-right: 15px; }
#stampSelector {
  display:none;
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:#fff8b3;
  border:2px solid #cc9900;
  padding:15px;
  z-index:999;
}
#stampSelector img {
  width:60px;
  cursor:pointer;
  margin:5px;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>

<h1>è‰¯ã„ã“ã¨æ‚ªã„ã“ã¨è€ƒå¯Ÿç”¨</h1>
<p>ä½œ: ã‚‰ã‚‚</p>

<div id="toc">
  <a href="#voteSection">æŠ•ç¥¨</a>
  <a href="#messageSection">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</a>
  <a href="#adminSection">ç®¡ç†è€…æ¨©é™</a>
</div>

<h2 id="voteSection">æŠ•ç¥¨</h2>

<div><label><input type="radio" name="vote" value="ã‚¿ã‚«ã‚­ãƒ³ã‚°">ã‚¿ã‚«ã‚­ãƒ³ã‚°</label><span id="takakingCount" class="voteResult">0</span></div>
<div><label><input type="radio" name="vote" value="ã‚¿ãƒ¼ãƒœãƒ¼">ã‚¿ãƒ¼ãƒœãƒ¼</label><span id="taboCount" class="voteResult">0</span></div>
<div><label><input type="radio" name="vote" value="ã‚¿ãƒ¼ãƒœãƒ¼ã®å¦»">ã‚¿ãƒ¼ãƒœãƒ¼ã®å¦»</label><span id="taboWifeCount" class="voteResult">0</span></div>
<div><label><input type="radio" name="vote" value="ã‚¤ãƒã‚¯ãƒ‹">ã‚¤ãƒã‚¯ãƒ‹</label><span id="imakuniCount" class="voteResult">0</span></div>
<div><label><input type="radio" name="vote" value="åˆ‘äº‹">åˆ‘äº‹</label><span id="keijiCount" class="voteResult">0</span></div>
<div><label><input type="radio" name="vote" value="ã‚¢ãƒãƒ­">ã‚¢ãƒãƒ­</label><span id="apolloCount" class="voteResult">0</span></div>

<button id="voteBtn">æŠ•ç¥¨ã™ã‚‹</button>
<p id="voteDone" style="display:none;color:red;">æŠ•ç¥¨æ¸ˆã¿</p>

<hr>

<h2 id="messageSection">ãŠè©±ã—ã‚¾ãƒ¼ãƒ³</h2>

<input id="nameInput" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆ20æ–‡å­—ã¾ã§ï¼‰">
<textarea id="messageInput" rows="4" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆ200æ–‡å­—ã¾ã§ï¼‰"></textarea>

<div class="row">
  <button onclick="sendMessage()">é€ä¿¡</button>
  <button onclick="toggleUnknownTime()" id="timeBtn">æ™‚é–“ï¼šé€šå¸¸</button>
</div>

<div class="row">
  <button onclick="openStampSelector()">ã‚¹ã‚¿ãƒ³ãƒ—</button>
  <button onclick="sharePage()">ã¿ã‚“ãªã‚’å‘¼ã¶ğŸ””</button>
</div>

<p id="myID"></p>

<div id="stampSelector">
  <img src="stamp1.png" onclick="sendStamp('stamp1.png')">
  <img src="stamp2.png" onclick="sendStamp('stamp2.png')">
  <img src="stamp3.png" onclick="sendStamp('stamp3.png')">
  <br><button onclick="closeStampSelector()">é–‰ã˜ã‚‹</button>
</div>

<h3>ã¿ã‚“ãªã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
<div id="chatBox"></div>

<p id="onlineCount"></p>
<p id="onlineIDs"></p>

<hr>

<div id="adminBox">
<h2 id="adminSection">ç®¡ç†è€…æ¨©é™</h2>
<input id="adminInput" placeholder="ç®¡ç†è€…ã‚³ãƒ¼ãƒ‰">
<button id="deleteAll">âš  å…¨å‰Šé™¤</button>

<h3>BAN</h3>
<input id="banIDInput" placeholder="BANã™ã‚‹ID">
<button id="banBtn">BAN</button>
<input id="unbanIDInput" placeholder="è§£é™¤ID">
<button id="unbanBtn">è§£é™¤</button>

<h4>BANä¸­</h4>
<p id="banList"></p>

<h4>ç®¡ç†ãƒ­ã‚°</h4>
<div id="adminLogs"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDcds20u1-6-nk7710P4xddsa-m1wDL0TQ",
  authDomain: "iikotowaruikoto-d5aa7.firebaseapp.com",
  databaseURL: "https://iikotowaruikoto-d5aa7-default-rtdb.firebaseio.com",
  projectId: "iikotowaruikoto-d5aa7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userID = localStorage.getItem("userID") || Math.random().toString(36).slice(2,10);
localStorage.setItem("userID", userID);
document.getElementById("myID").textContent = "ã‚ãªãŸã®ID: " + userID;

// ===== å…±æœ‰ =====
function sharePage() {
  if (navigator.share) {
    navigator.share({ title: document.title, url: location.href });
  } else {
    alert("ã“ã®ãƒšãƒ¼ã‚¸ã®URLã‚’å…±æœ‰ã—ã¦ãã ã•ã„:\n" + location.href);
  }
}

// ===== æŠ•ç¥¨ï¼ˆ1å›åˆ¶é™ï¼‰=====
if (localStorage.getItem("voted")) {
  document.getElementById("voteBtn").disabled = true;
  document.getElementById("voteDone").style.display = "block";
}
document.getElementById("voteBtn").onclick = () => {
  if (localStorage.getItem("voted")) return;
  const v = document.querySelector('input[name="vote"]:checked');
  if (!v) return alert("é¸ã‚“ã§");
  db.ref("votes/"+v.value).transaction(n=>(n||0)+1);
  localStorage.setItem("voted","1");
  location.reload();
};

// ===== ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ =====
let unknownTime=false;
function toggleUnknownTime(){
  unknownTime=!unknownTime;
  timeBtn.textContent = unknownTime?"æ™‚é–“ï¼šä¸æ˜":"æ™‚é–“ï¼šé€šå¸¸";
}
function sendMessage(){
  const name=nameInput.value.trim();
  const msg=messageInput.value.trim();
  if(!name||!msg) return alert("æœªå…¥åŠ›");
  if(name.length>20||msg.length>200) return alert("é•·ã™ã");
  const time=unknownTime?"unknown":Date.now();
  db.ref("messages").push({name,message:msg,userID,timestamp:time,type:"text"});
  messageInput.value="";
}
function sendStamp(src){
  db.ref("messages").push({name:nameInput.value,userID,stampUrl:src,type:"stamp",timestamp:Date.now()});
  closeStampSelector();
}
function openStampSelector(){ stampSelector.style.display="block"; }
function closeStampSelector(){ stampSelector.style.display="none"; }

// ===== ãƒãƒ£ãƒƒãƒˆè¡¨ç¤ºï¼ˆ50ä»¶ï¼‰=====
db.ref("messages").limitToLast(50).on("child_added", s=>{
  const m=s.val();
  const p=document.createElement("p");
  p.className="message";
  const t=m.timestamp==="unknown"?"ä¸æ˜":new Date(m.timestamp).toLocaleString();
  if(m.type==="stamp"){
    p.innerHTML=`<b>${m.name}[${m.userID}]</b><br><img src="${m.stampUrl}" width="80"><br>${t}`;
  }else{
    p.innerHTML=`<b>${m.name}[${m.userID}]</b><br>${m.message}<br>${t}`;
  }
  chatBox.prepend(p);
});
</script>

</body>
</html>
