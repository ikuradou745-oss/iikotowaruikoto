<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>è‰¯ã„ã“ã¨æ‚ªã„ã“ã¨è€ƒå¯Ÿç”¨</title>

<style>
  body { 
    font-family: sans-serif; 
    background: #ffffcc; 
    padding: 20px; 
  }

  .voteResult {
    font-weight: bold; 
    margin-left: 10px; 
    color: #cc9900;
  }

  #chatBox { 
    border: 1px solid #cc9900; 
    background: #fff8b3; 
    padding: 10px; 
    height: 300px; 
    overflow-y: auto; 
  }

  input, textarea { 
    width: 100%; 
    margin-bottom: 10px; 
    padding: 8px; 
    font-size: 1em; 
  }

  button { 
    background-color: #cc9900; 
    color: white; 
    padding: 10px; 
    border: none; 
    border-radius: 4px; 
    cursor: pointer; 
    margin-bottom: 10px;
  }

  .row {
    display: flex;
    gap: 10px;
  }

  .row button {
    flex: 1;
  }

  p.message {
    border-bottom: 1px solid #cc9900;
    padding-bottom: 5px;
    margin-bottom: 5px;
  }

  #adminBox {
    margin-top: 40px;
    padding: 15px;
    border: 2px dashed #aa7700;
    background: #fff3a0;
  }

  #toc {
    margin: 10px 0 30px 0;
  }

  #toc a {
    color: #0066ff;
    text-decoration: none;
    font-weight: bold;
    margin-right: 15px;
  }

  #toc a:hover {
    text-decoration: underline;
  }

  #stampSelector {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #fff8b3;
    border: 2px solid #cc9900;
    border-radius: 8px;
    padding: 15px;
    z-index: 1000;
    box-shadow: 0 0 10px #cc9900;
  }

  #stampSelector .stampList img {
    width: 60px;
    height: 60px;
    cursor: pointer;
    margin: 5px;
  }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>

<h1>è‰¯ã„ã“ã¨æ‚ªã„ã“ã¨è€ƒå¯Ÿç”¨</h1>
<p>ä½œï¼šã‚‰ã‚‚</p>

<div id="toc">
  <a href="#voteSection">æŠ•ç¥¨</a>
  <a href="#messageSection">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</a>
  <a href="#adminSection">ç®¡ç†è€…æ¨©é™</a>
</div>

<h2 id="voteSection">æŠ•ç¥¨ãŠé¡˜ã„ã—ã¾ã™</h2>

<div><label><input type="radio" name="vote" value="ã‚¿ã‚«ã‚­ãƒ³ã‚°"> ã‚¿ã‚«ã‚­ãƒ³ã‚°</label> <span class="voteResult" id="takakingCount">0 ç¥¨</span></div>
<div><label><input type="radio" name="vote" value="ã‚¿ãƒ¼ãƒœãƒ¼"> ã‚¿ãƒ¼ãƒœãƒ¼</label> <span class="voteResult" id="taboCount">0 ç¥¨</span></div>
<div><label><input type="radio" name="vote" value="ã‚¿ãƒ¼ãƒœãƒ¼ã®å¦»"> ã‚¿ãƒ¼ãƒœãƒ¼ã®å¦»</label> <span class="voteResult" id="taboWifeCount">0 ç¥¨</span></div>
<div><label><input type="radio" name="vote" value="ã‚¤ãƒã‚¯ãƒ‹"> ã‚¤ãƒã‚¯ãƒ‹</label> <span class="voteResult" id="imakuniCount">0 ç¥¨</span></div>
<div><label><input type="radio" name="vote" value="åˆ‘äº‹"> åˆ‘äº‹</label> <span class="voteResult" id="keijiCount">0 ç¥¨</span></div>
<div><label><input type="radio" name="vote" value="ã‚¢ãƒãƒ­"> ã‚¢ãƒãƒ­</label> <span class="voteResult" id="apolloCount">0 ç¥¨</span></div>

<button onclick="vote()">æŠ•ç¥¨ã™ã‚‹</button>

<hr>

<h2 id="messageSection">ãŠè©±ã—ã‚¾ãƒ¼ãƒ³</h2>

<input id="nameInput" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ">
<textarea id="messageInput" rows="4"></textarea>

<div class="row">
  <button onclick="sendMessage()">é€ä¿¡</button>
  <button onclick="toggleUnknownTime()" id="timeBtn">æ™‚é–“ï¼šé€šå¸¸</button>
</div>

<div class="row">
  <button onclick="openStampSelector()">ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é¸æŠ</button>
  <button onclick="shareBoard()">ã¿ã‚“ãªã‚’å‘¼ã¶ğŸ””</button>
</div>

<div id="stampSelector">
  <h3>ã‚¹ã‚¿ãƒ³ãƒ—</h3>
  <div class="stampList" id="stampList"></div>
  <button onclick="closeStampSelector()">é–‰ã˜ã‚‹</button>
</div>

<h3>ã¿ã‚“ãªã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
<div id="chatBox"></div>

<p id="onlineCount">è¦‹ã¦ã„ã‚‹äºº: 0äºº</p>
<p id="onlineIDs">è¦‹ã¦ã„ã‚‹äººã®ID: ãªã—</p>

<hr>

<div id="adminBox">
  <h2 id="adminSection">ç®¡ç†è€…æ¨©é™</h2>
  <input id="adminInput" placeholder="ç®¡ç†è€…ã‚³ãƒ¼ãƒ‰">
  <button id="deleteAll">âš  å…¨å‰Šé™¤</button>

  <h3>BAN</h3>
  <input id="banIDInput" placeholder="BAN ID">
  <button id="banBtn">BAN</button>
  <input id="unbanIDInput" placeholder="è§£é™¤ ID">
  <button id="unbanBtn">è§£é™¤</button>

  <p id="banList">ãªã—</p>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDcds20u1-6-nk7710P4xddsa-m1wDL0TQ",
  databaseURL: "https://iikotowaruikoto-d5aa7-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userID = localStorage.getItem("userID") || Math.random().toString(36).slice(2,10);
localStorage.setItem("userID", userID);

let unknownTime = false;
function toggleUnknownTime(){
  unknownTime=!unknownTime;
  timeBtn.textContent = unknownTime ? "æ™‚é–“ï¼šä¸æ˜" : "æ™‚é–“ï¼šé€šå¸¸";
}

function vote(){
  const v=document.querySelector('input[name="vote"]:checked');
  if(!v) return;
  db.ref("votes/"+v.value).transaction(n=>(n||0)+1);
}

db.ref("votes").on("value",s=>{
  const v=s.val()||{};
  takakingCount.textContent=(v["ã‚¿ã‚«ã‚­ãƒ³ã‚°"]||0)+" ç¥¨";
  taboCount.textContent=(v["ã‚¿ãƒ¼ãƒœãƒ¼"]||0)+" ç¥¨";
  taboWifeCount.textContent=(v["ã‚¿ãƒ¼ãƒœãƒ¼ã®å¦»"]||0)+" ç¥¨";
  imakuniCount.textContent=(v["ã‚¤ãƒã‚¯ãƒ‹"]||0)+" ç¥¨";
  keijiCount.textContent=(v["åˆ‘äº‹"]||0)+" ç¥¨";
  apolloCount.textContent=(v["ã‚¢ãƒãƒ­"]||0)+" ç¥¨";
});

db.ref("messages").on("child_added",s=>{
  const m=s.val();
  const t=m.timestamp==="unknown"?"ä¸æ˜":new Date(m.timestamp).toLocaleString();
  chatBox.innerHTML=`<p class="message"><b>${m.name}[${m.userID}]</b><br>`+
  (m.type==="stamp"?`<img src="${m.stampUrl}" width="80">`:m.message)+
  `<br><small>${t}</small></p>`+chatBox.innerHTML;
});

function sendMessage(){
  if(!nameInput.value||!messageInput.value) return;
  db.ref("messages").push({
    name:nameInput.value,
    message:messageInput.value,
    userID,
    timestamp: unknownTime?"unknown":Date.now(),
    type:"text"
  });
  messageInput.value="";
}

const stamps=["stamp1.png","stamp2.png","stamp3.png"];
function openStampSelector(){
  stampList.innerHTML="";
  stamps.forEach(s=>{
    const i=document.createElement("img");
    i.src=s;
    i.onclick=()=>sendStamp(s);
    stampList.appendChild(i);
  });
  stampSelector.style.display="block";
}
function closeStampSelector(){stampSelector.style.display="none";}
function sendStamp(s){
  if(!nameInput.value) return;
  db.ref("messages").push({
    name:nameInput.value,
    userID,
    stampUrl:s,
    timestamp: unknownTime?"unknown":Date.now(),
    type:"stamp"
  });
  closeStampSelector();
}

function shareBoard(){
  const text="æ²ç¤ºæ¿ã§å¾…ã£ã¦ã‚‹ã‚ˆï¼\nhttps://ikuradou745-oss.github.io/iikotowaruikoto/";
  if(navigator.share){
    navigator.share({text,url:"https://ikuradou745-oss.github.io/iikotowaruikoto/"});
  }else{
    navigator.clipboard.writeText(text);
    alert("æ–‡ç« ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
  }
}
</script>

</body>
</html>
