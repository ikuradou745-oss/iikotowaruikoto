<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Firebaseリアルタイム投票＆チャット</title>
<style>
  body { font-family: sans-serif; background: #ffffcc; padding: 20px; }
  .voteResult { font-weight: bold; margin-left: 10px; color: #cc9900; }
  #chatBox { border: 1px solid #cc9900; background: #fff8b3; padding: 10px; height: 200px; overflow-y: auto; }
  input, textarea { width: 100%; margin-bottom: 10px; padding: 8px; font-size: 1em; }
  button { background-color: #cc9900; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

</head>
<body>

<h1>良いこと悪いこと考察用</h1>

<h2>投票お願いします</h2>
<p>犯人は誰だと思う？</p>

<div>
  <label><input type="radio" name="vote" value="タカキング"> タカキング！</label>
  <span class="voteResult" id="takakingCount">0 票</span>
</div>

<div>
  <label><input type="radio" name="vote" value="ターボー"> ターボー</label>
  <span class="voteResult" id="taboCount">0 票</span>
</div>

<div>
  <label><input type="radio" name="vote" value="イマクニ"> イマクニ？</label>
  <span class="voteResult" id="imakuniCount">0 票</span>
</div>

<div>
  <label><input type="radio" name="vote" value="刑事"> 刑事？</label>
  <span class="voteResult" id="keijiCount">0 票</span>
</div>

<div>
  <label><input type="radio" name="vote" value="アポロ"> アポロとか！</label>
  <span class="voteResult" id="apolloCount">0 票</span>
</div>

<button onclick="vote()">投票する</button>

<hr>

<h2>お話しゾーン</h2>

<p>ニックネーム</p>
<input type="text" id="nameInput" placeholder="ニックネームを入力" />

<p>メッセージを入れてね</p>
<textarea id="messageInput" rows="4" placeholder="メッセージを入力"></textarea>

<button onclick="sendMessage()">メッセージ送る</button>

<h3>みんなのメッセージ</h3>
<div id="chatBox"></div>

<script>
  // Firebaseの設定
  const firebaseConfig = {
    apiKey: "AIzaSyDcds20u1-6-nk7710P4xddsa-m1wDL0TQ",
    authDomain: "iikotowaruikoto-d5aa7.firebaseapp.com",
    databaseURL: "https://iikotowaruikoto-d5aa7-default-rtdb.firebaseio.com",
    projectId: "iikotowaruikoto-d5aa7",
    storageBucket: "iikotowaruikoto-d5aa7.appspot.com",
    messagingSenderId: "455780219216",
    appId: "1:455780219216:web:225461fcf24c1a46f69455"
  };

  // Firebase初期化
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // 投票結果の表示更新
  function updateVotesUI(votes) {
    document.getElementById("takakingCount").innerText = (votes["タカキング"] || 0) + " 票";
    document.getElementById("taboCount").innerText = (votes["ターボー"] || 0) + " 票";
    document.getElementById("imakuniCount").innerText = (votes["イマクニ"] || 0) + " 票";
    document.getElementById("keijiCount").innerText = (votes["刑事"] || 0) + " 票";
    document.getElementById("apolloCount").innerText = (votes["アポロ"] || 0) + " 票";
  }

  // 投票のリアルタイム更新
  db.ref('votes').on('value', (snapshot) => {
    const votes = snapshot.val() || {};
    updateVotesUI(votes);
  });

  // 投票処理
  function vote() {
    const selected = document.querySelector('input[name="vote"]:checked');
    if (!selected) {
      alert("誰かを選んでね！");
      return;
    }
    const voteName = selected.value;
    const voteRef = db.ref('votes/' + voteName);
    voteRef.transaction(current => (current || 0) + 1);
    alert("投票ありがとう！");
  }

  // チャットのメッセージ表示場所
  const chatBox = document.getElementById("chatBox");

  // 新しいメッセージが来たらリアルタイムで表示
  db.ref('messages').on('child_added', (snapshot) => {
    const msg = snapshot.val();
    if (msg && msg.name && msg.message) {
      const p = document.createElement('p');
      p.textContent = msg.name + "：" + msg.message;
      chatBox.appendChild(p);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  });

  // メッセージ送信処理
  function sendMessage() {
    const name = document.getElementById("nameInput").value.trim();
    const message = document.getElementById("messageInput").value.trim();
    if (!name || !message) {
      alert("名前とメッセージを入れてね！");
      return;
    }
    db.ref('messages').push({ name, message });
    document.getElementById("messageInput").value = "";
  }
</script>

</body>
</html>
